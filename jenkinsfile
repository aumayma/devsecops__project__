pipeline {
    agent any

    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/aumayma/devsecops__project__.git'
            }
        }

stage('Run Gitleaks') {
            steps {
                script {
                    def result = sh(script: 'gitleaks detect --source . --verbose --redact', returnStatus: true)
                    if (result != 0) {
                        error("âŒ Des secrets ont Ã©tÃ© dÃ©tectÃ©s ! Corrige-les avant de pousser le code.")
                    }
                }
            }
        }
       # stage('Notifier sur Slack') {
        #    steps {
         #       script {
          #          def secretsFound = sh(script: "gitleaks detect --source . --verbose", returnStatus: true)
           #         if (secretsFound == 0) {
            #            slackSend (channel: '#alerts', message: 'âœ… Aucun secret dÃ©tectÃ©. DÃ©ploiement autorisÃ©.')
             #       } else {
              #          slackSend (channel: '#alerts', message: 'ğŸš¨ Secret dÃ©tectÃ© ! DÃ©ploiement annulÃ©.')
               #         error('Secrets dÃ©tectÃ©s, arrÃªt du pipeline.')
                #    }
                #}
            #}
        #}

        
